<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProConnect Messenger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase v9 Compat -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        .chat-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .chat-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .chat-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .chat-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, createContext, useContext } = React;

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: 'AIzaSyCYYzVnVB0JheAYre5c21d_xWv1HabIRPM',
            authDomain: 'brainy-18fda.firebaseapp.com',
            databaseURL: 'https://brainy-18fda-default-rtdb.firebaseio.com',
            projectId: 'brainy-18fda',
            storageBucket: 'brainy-18fda.firebasestorage.app',
            messagingSenderId: '659063130521',
            appId: '1:659063130521:web:938a8b6f32506dc4aceb08',
            measurementId: 'G-M1X3YW1SZF'
        };

        // Initialize Firebase
        let auth, db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            auth = firebase.auth();
            db = firebase.firestore();
            
            // Enable persistence
            db.enablePersistence({ synchronizeTabs: true }).catch((err) => {
                if (err.code === 'failed-precondition') {
                    console.log('Persistence failed: Multiple tabs open');
                } else if (err.code === 'unimplemented') {
                    console.log('Persistence not available');
                }
            });
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }

        // Auth Context
        const AuthContext = createContext();
        const useAuth = () => useContext(AuthContext);

        // Utility Functions
        const generateShareCode = () => {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        };

        const getChatId = (uid1, uid2) => {
            return [uid1, uid2].sort().join('_');
        };

        const formatTimestamp = (timestamp) => {
            if (!timestamp) return '';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        };

        // Toast Component
        const Toast = ({ message, type = 'info', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const bgColor = type === 'error' ? 'bg-red-500' : type === 'success' ? 'bg-green-500' : 'bg-blue-500';

            return (
                <div className={`fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-in`}>
                    {message}
                </div>
            );
        };

        // Auth Provider Component
        const AuthProvider = ({ children }) => {
            const [currentUser, setCurrentUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                if (!auth) {
                    console.error('Firebase Auth not initialized');
                    setLoading(false);
                    return;
                }
                
                const unsubscribe = auth.onAuthStateChanged(
                    (user) => {
                        console.log('Auth state changed:', user ? user.uid : 'No user');
                        setCurrentUser(user);
                        setLoading(false);
                    },
                    (error) => {
                        console.error('Auth state change error:', error);
                        setLoading(false);
                    }
                );
                
                return () => {
                    if (unsubscribe) unsubscribe();
                };
            }, []);

            const value = { currentUser };

            return (
                <AuthContext.Provider value={value}>
                    {!loading ? children : (
                        <div className="min-h-screen flex items-center justify-center bg-gray-100">
                            <div className="text-center">
                                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                <p className="text-gray-600">Loading...</p>
                            </div>
                        </div>
                    )}
                </AuthContext.Provider>
            );
        };

        // Auth Component
        const AuthPage = () => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [toast, setToast] = useState(null);

            const showToast = (message, type = 'info') => {
                setToast({ message, type });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!email || !password) {
                    showToast('Please enter both email and password.', 'error');
                    return;
                }
                
                setLoading(true);

                try {
                    if (isLogin) {
                        // Login
                        const userCredential = await auth.signInWithEmailAndPassword(email, password);
                        console.log('Login successful:', userCredential.user.uid);
                        showToast('Login successful!', 'success');
                    } else {
                        // Signup
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        const user = userCredential.user;
                        console.log('Signup successful:', user.uid);
                        
                        // Create user document in Firestore
                        await db.collection('users').doc(user.uid).set({
                            uid: user.uid,
                            email: user.email,
                            shareCode: generateShareCode(),
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            friendsList: []
                        });
                        
                        console.log('User document created');
                        showToast('Account created successfully!', 'success');
                    }
                } catch (error) {
                    console.error('Auth error:', error);
                    let errorMessage = 'An error occurred. Please try again.';
                    
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'Email already in use. Please login.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Invalid email address.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Password should be at least 6 characters.';
                    } else if (error.code === 'auth/user-not-found') {
                        errorMessage = 'User not found. Please sign up.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Incorrect password.';
                    } else if (error.code === 'auth/invalid-credential') {
                        errorMessage = 'Invalid credentials. Please check your email and password.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Too many failed attempts. Please try again later.';
                    } else if (error.code === 'auth/network-request-failed') {
                        errorMessage = 'Network error. Please check your connection.';
                    } else {
                        errorMessage = error.message || 'Authentication failed. Please try again.';
                    }
                    
                    showToast(errorMessage, 'error');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center p-4">
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-md p-8">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">ProConnect</h1>
                            <p className="text-gray-600">Professional Messaging Platform</p>
                        </div>

                        <div className="flex bg-gray-100 rounded-lg p-1 mb-6">
                            <button
                                onClick={() => setIsLogin(true)}
                                className={`flex-1 py-2 rounded-md font-medium transition-all ${
                                    isLogin ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600'
                                }`}
                            >
                                Login
                            </button>
                            <button
                                onClick={() => setIsLogin(false)}
                                className={`flex-1 py-2 rounded-md font-medium transition-all ${
                                    !isLogin ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-600'
                                }`}
                            >
                                Sign Up
                            </button>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Email Address
                                </label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                    placeholder="you@example.com"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Password
                                </label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                    placeholder="••••••••"
                                    required
                                    minLength="6"
                                />
                            </div>

                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:bg-blue-400 disabled:cursor-not-allowed"
                            >
                                {loading ? (
                                    <span className="flex items-center justify-center">
                                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        Processing...
                                    </span>
                                ) : isLogin ? 'Login' : 'Create Account'}
                            </button>
                        </form>

                        <p className="text-center text-sm text-gray-600 mt-6">
                            {isLogin ? "Don't have an account? " : "Already have an account? "}
                            <button
                                onClick={() => setIsLogin(!isLogin)}
                                className="text-blue-600 font-medium hover:underline"
                            >
                                {isLogin ? 'Sign Up' : 'Login'}
                            </button>
                        </p>
                    </div>
                </div>
            );
        };

        // Chat List Item Component
        const ChatListItem = ({ chat, onClick, isActive }) => {
            const { currentUser } = useAuth();
            const [friendData, setFriendData] = useState(null);

            useEffect(() => {
                const friendId = chat.participants?.find(id => id !== currentUser?.uid);
                if (friendId) {
                    db.collection('users').doc(friendId).get().then(doc => {
                        if (doc.exists) {
                            setFriendData(doc.data());
                        }
                    });
                }
            }, [chat, currentUser]);

            if (!friendData) return null;

            const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(friendData.email)}&background=3b82f6&color=fff&size=128`;

            return (
                <div
                    onClick={onClick}
                    className={`flex items-center space-x-3 p-4 cursor-pointer transition-colors border-b border-gray-100 ${
                        isActive ? 'bg-blue-50' : 'hover:bg-gray-50'
                    }`}
                >
                    <img
                        src={avatarUrl}
                        alt={friendData.email}
                        className="w-12 h-12 rounded-full"
                    />
                    <div className="flex-1 min-w-0">
                        <h3 className="font-semibold text-gray-800 truncate">{friendData.email}</h3>
                        <p className="text-sm text-gray-500 truncate">{chat.lastMessage || 'No messages yet'}</p>
                    </div>
                    <span className="text-xs text-gray-400">{formatTimestamp(chat.timestamp)}</span>
                </div>
            );
        };

        // Message Component
        const Message = ({ message, isOwn }) => {
            return (
                <div className={`flex ${isOwn ? 'justify-end' : 'justify-start'} mb-4`}>
                    <div
                        className={`max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${
                            isOwn
                                ? 'bg-blue-600 text-white rounded-br-none'
                                : 'bg-gray-200 text-gray-800 rounded-bl-none'
                        }`}
                    >
                        <p className="break-words">{message.text}</p>
                        <span className={`text-xs mt-1 block ${isOwn ? 'text-blue-100' : 'text-gray-500'}`}>
                            {formatTimestamp(message.timestamp)}
                        </span>
                    </div>
                </div>
            );
        };

        // Chat Window Component
        const ChatWindow = ({ chatId, friendEmail, onBack }) => {
            const { currentUser } = useAuth();
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const [loading, setLoading] = useState(false);
            const messagesEndRef = useRef(null);

            useEffect(() => {
                if (!chatId) return;

                const unsubscribe = db
                    .collection('chats')
                    .doc(chatId)
                    .collection('messages')
                    .orderBy('timestamp', 'asc')
                    .onSnapshot(snapshot => {
                        const msgs = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setMessages(msgs);
                    });

                return unsubscribe;
            }, [chatId]);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            const handleSend = async (e) => {
                e.preventDefault();
                if (!newMessage.trim() || loading) return;

                setLoading(true);
                try {
                    const messageData = {
                        text: newMessage.trim(),
                        senderId: currentUser.uid,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await db.collection('chats').doc(chatId).collection('messages').add(messageData);
                    
                    await db.collection('chats').doc(chatId).update({
                        lastMessage: newMessage.trim(),
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    setNewMessage('');
                } catch (error) {
                    console.error('Error sending message:', error);
                } finally {
                    setLoading(false);
                }
            };

            const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(friendEmail)}&background=3b82f6&color=fff&size=128`;

            return (
                <div className="flex flex-col h-full">
                    {/* Chat Header */}
                    <div className="bg-white border-b border-gray-200 px-4 py-3 flex items-center space-x-3">
                        <button
                            onClick={onBack}
                            className="lg:hidden text-gray-600 hover:text-gray-800 mr-2"
                        >
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <img src={avatarUrl} alt={friendEmail} className="w-10 h-10 rounded-full" />
                        <div className="flex-1">
                            <h2 className="font-semibold text-gray-800">{friendEmail}</h2>
                            <p className="text-xs text-green-500">Online</p>
                        </div>
                    </div>

                    {/* Messages Area */}
                    <div className="flex-1 overflow-y-auto chat-scroll bg-gray-50 p-4">
                        {messages.length === 0 ? (
                            <div className="flex items-center justify-center h-full">
                                <p className="text-gray-400">No messages yet. Start the conversation!</p>
                            </div>
                        ) : (
                            messages.map(msg => (
                                <Message
                                    key={msg.id}
                                    message={msg}
                                    isOwn={msg.senderId === currentUser.uid}
                                />
                            ))
                        )}
                        <div ref={messagesEndRef} />
                    </div>

                    {/* Message Input */}
                    <form onSubmit={handleSend} className="bg-white border-t border-gray-200 p-4">
                        <div className="flex space-x-2">
                            <input
                                type="text"
                                value={newMessage}
                                onChange={(e) => setNewMessage(e.target.value)}
                                placeholder="Type a message..."
                                className="flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                            />
                            <button
                                type="submit"
                                disabled={loading || !newMessage.trim()}
                                className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full font-medium transition-colors disabled:bg-blue-400 disabled:cursor-not-allowed"
                            >
                                Send
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // Add Friend Modal
        const AddFriendModal = ({ onClose, onSuccess }) => {
            const { currentUser } = useAuth();
            const [email, setEmail] = useState('');
            const [loading, setLoading] = useState(false);
            const [toast, setToast] = useState(null);

            const showToast = (message, type = 'info') => {
                setToast({ message, type });
            };

            const handleAddFriend = async (e) => {
                e.preventDefault();
                if (!email.trim()) return;

                setLoading(true);
                try {
                    // Query users collection by email
                    const querySnapshot = await db.collection('users').where('email', '==', email.trim()).get();

                    if (querySnapshot.empty) {
                        showToast('User not found with this email address.', 'error');
                        setLoading(false);
                        return;
                    }

                    const friendDoc = querySnapshot.docs[0];
                    const friendData = friendDoc.data();

                    if (friendData.uid === currentUser.uid) {
                        showToast('You cannot add yourself as a friend.', 'error');
                        setLoading(false);
                        return;
                    }

                    // Check if already friends
                    const currentUserDoc = await db.collection('users').doc(currentUser.uid).get();
                    const currentUserData = currentUserDoc.data();
                    
                    if (currentUserData.friendsList?.includes(friendData.uid)) {
                        showToast('This user is already your friend.', 'error');
                        setLoading(false);
                        return;
                    }

                    // Add to friends list
                    await db.collection('users').doc(currentUser.uid).update({
                        friendsList: firebase.firestore.FieldValue.arrayUnion(friendData.uid)
                    });

                    await db.collection('users').doc(friendData.uid).update({
                        friendsList: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
                    });

                    // Create chat document
                    const chatId = getChatId(currentUser.uid, friendData.uid);
                    const chatRef = db.collection('chats').doc(chatId);
                    const chatDoc = await chatRef.get();

                    if (!chatDoc.exists) {
                        await chatRef.set({
                            participants: [currentUser.uid, friendData.uid],
                            lastMessage: '',
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }

                    showToast('Friend added successfully!', 'success');
                    setTimeout(() => {
                        onSuccess();
                        onClose();
                    }, 1000);
                } catch (error) {
                    console.error('Error adding friend:', error);
                    showToast('Failed to add friend. Please try again.', 'error');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold text-gray-800">Add Friend</h2>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>

                        <form onSubmit={handleAddFriend} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Friend's Email Address
                                </label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                                    placeholder="friend@example.com"
                                    required
                                />
                            </div>

                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors disabled:bg-blue-400 disabled:cursor-not-allowed"
                            >
                                {loading ? 'Adding...' : 'Add Friend'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // Main Chat App Component
        const ChatApp = () => {
            const { currentUser } = useAuth();
            const [chats, setChats] = useState([]);
            const [selectedChat, setSelectedChat] = useState(null);
            const [selectedFriend, setSelectedFriend] = useState(null);
            const [showAddFriend, setShowAddFriend] = useState(false);
            const [showSidebar, setShowSidebar] = useState(true);
            const [toast, setToast] = useState(null);

            useEffect(() => {
                if (!currentUser) return;

                const unsubscribe = db
                    .collection('chats')
                    .where('participants', 'array-contains', currentUser.uid)
                    .onSnapshot(snapshot => {
                        const chatList = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        chatList.sort((a, b) => {
                            const aTime = a.timestamp?.toMillis() || 0;
                            const bTime = b.timestamp?.toMillis() || 0;
                            return bTime - aTime;
                        });
                        setChats(chatList);
                    });

                return unsubscribe;
            }, [currentUser]);

            const handleChatSelect = async (chat) => {
                const friendId = chat.participants.find(id => id !== currentUser.uid);
                const friendDoc = await db.collection('users').doc(friendId).get();
                
                if (friendDoc.exists) {
                    setSelectedChat(chat.id);
                    setSelectedFriend(friendDoc.data().email);
                    setShowSidebar(false);
                }
            };

            const handleShare = async () => {
                const shareText = `Join me on ProConnect! My Email is: ${currentUser.email}`;
                
                try {
                    if (navigator.share) {
                        await navigator.share({
                            title: 'ProConnect Messenger',
                            text: shareText
                        });
                    } else if (navigator.clipboard) {
                        await navigator.clipboard.writeText(shareText);
                        setToast({ message: 'Invite link copied to clipboard!', type: 'success' });
                    } else {
                        setToast({ message: 'Sharing not supported on this device.', type: 'error' });
                    }
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        console.error('Share error:', error);
                    }
                }
            };

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                } catch (error) {
                    console.error('Logout error:', error);
                }
            };

            return (
                <div className="h-screen flex bg-gray-100">
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    
                    {/* Sidebar */}
                    <div className={`${showSidebar ? 'flex' : 'hidden'} lg:flex flex-col w-full lg:w-96 bg-white border-r border-gray-200`}>
                        {/* Sidebar Header */}
                        <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4">
                            <div className="flex items-center justify-between mb-4">
                                <h1 className="text-xl font-bold">ProConnect</h1>
                                <button
                                    onClick={handleLogout}
                                    className="text-white hover:text-blue-100 transition-colors"
                                    title="Logout"
                                >
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                    </svg>
                                </button>
                            </div>
                            
                            <div className="flex space-x-2">
                                <button
                                    onClick={() => setShowAddFriend(true)}
                                    className="flex-1 bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition-colors"
                                >
                                    + Add Friend
                                </button>
                                <button
                                    onClick={handleShare}
                                    className="bg-blue-500 hover:bg-blue-400 text-white px-4 py-2 rounded-lg font-medium transition-colors"
                                    title="Share"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        {/* Chat List */}
                        <div className="flex-1 overflow-y-auto chat-scroll">
                            {chats.length === 0 ? (
                                <div className="flex flex-col items-center justify-center h-full p-8 text-center">
                                    <svg className="w-16 h-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                    </svg>
                                    <p className="text-gray-500">No conversations yet</p>
                                    <p className="text-sm text-gray-400 mt-2">Add friends to start chatting</p>
                                </div>
                            ) : (
                                chats.map(chat => (
                                    <ChatListItem
                                        key={chat.id}
                                        chat={chat}
                                        onClick={() => handleChatSelect(chat)}
                                        isActive={chat.id === selectedChat}
                                    />
                                ))
                            )}
                        </div>
                    </div>

                    {/* Chat Window */}
                    <div className={`${!showSidebar ? 'flex' : 'hidden'} lg:flex flex-col flex-1`}>
                        {selectedChat ? (
                            <ChatWindow
                                chatId={selectedChat}
                                friendEmail={selectedFriend}
                                onBack={() => setShowSidebar(true)}
                            />
                        ) : (
                            <div className="hidden lg:flex items-center justify-center h-full bg-gray-50">
                                <div className="text-center">
                                    <svg className="w-24 h-24 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                    </svg>
                                    <h2 className="text-2xl font-semibold text-gray-600 mb-2">Welcome to ProConnect</h2>
                                    <p className="text-gray-400">Select a conversation to start messaging</p>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Add Friend Modal */}
                    {showAddFriend && (
                        <AddFriendModal
                            onClose={() => setShowAddFriend(false)}
                            onSuccess={() => setToast({ message: 'Friend added!', type: 'success' })}
                        />
                    )}
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const { currentUser } = useAuth();

            return (
                <div className="h-screen">
                    {currentUser ? <ChatApp /> : <AuthPage />}
                </div>
            );
        };

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <AuthProvider>
                <App />
            </AuthProvider>
        );
    </script>
</body>
</html>